import tkinter as tk
from tkinter import *
from tkinter import messagebox
import random
from collections import Counter
import re
import collections 


window = Tk()
window.title("Лабораторная №1 шифр")
window.geometry("500x250")



#зашифровать 
 
def Zah():
    s = e.get()
#     s = """ абвгдежзийклмнопрстуфхцчшщъыьэюя
#     Что, Петр, не видать еще? — спрашивал 20-го мая 1859 года, выходя без шапки на низкое крылечко постоялого двора на *** шоссе, барин лет 
#     сорока с небольшим, в запыленном пальто и клетчатых панталонах, у своего слуги, молодого и щекастого малого с беловатым пухом на 
#     подбородке и маленькими тусклыми глазенками.
# Слуга, в котором все: и бирюзовая сережка в ухе, и напомаженные разноцветные волосы, и учтивые телодвижения, словом, все изобличало 
# человека новейшего, усовершенствованного поколения, посмотрел снисходительно вдоль дороги и ответствовал: «Никак нет-с, не видать».
# — Не видать? — повторил барин.
# — Не видать, — вторично ответствовал слуга.
# Барин вздохнул и присел на скамеечку. Познакомим с ним читателя, пока он сидит, подогнувши под себя ножки и задумчиво поглядывая кругом.
# Зовут его Николаем Петровичем Кирсановым. У него в пятнадцати верстах от постоялого дворика хорошее имение в двести душ, или, как он 
# выражается с тех пор, как размежевался с крестьянами и завел «ферму», — в две тысячи десятин земли. Отец его, боевой генерал 1812 года, 
# полуграмотный, грубый, но не злой русский человек, всю жизнь свою тянул лямку, командовал сперва бригадой, потом дивизией и постоянно жил 
# в провинции, где в силу своего чина играл довольно значительную роль. Николай Петрович родился на юге России, подобно старшему своему брату 
# Павлу, о котором речь впереди, и воспитывался до четырнадцатилетнего возраста дома, окруженный дешевыми гувернерами, развязными, но 
# подобострастными адъютантами и прочими полковыми и штабными личностями. Родительница его, из фамилии Колязиных, в девицах Agathe, а в 
# генеральшах Агафоклея Кузьминишна Кирсанова, принадлежала к числу «матушек-командирш», носила пышные чепцы и шумные шелковые платья, в 
# церкви подходила первая ко кресту, говорила громко и много, допускала детей утром к ручке, на ночь их благословляла, — словом, жила в 
# свое удовольствие. В качестве генеральского сына Николай Петрович — хотя не только не отличался храбростью, но даже заслужил прозвище 
# трусишки — должен был, подобно брату Павлу, поступить в военную службу; но он переломил себе ногу в самый тот день, когда уже прибыло 
# известие об его определении, и, пролежав два месяца в постели, на всю жизнь остался «хроменьким». Отец махнул на него рукой и пустил 
# его по штатской. Он повез его в Петербург, как только ему минул восемнадцатый год, и поместил его в университет. Кстати, брат его о ту 
# пору вышел офицером в гвардейский полк. Молодые люди стали жить вдвоем, на одной квартире, под отдаленным надзором двоюродного дяди с 
# материнской стороны, Ильи Колязина, важного чиновника. Отец их вернулся к своей дивизии и к своей супруге и лишь изредка присылал 
# сыновьям большие четвертушки серой бумаги, испещренные размашистым писарским почерком. На конце этих четвертушек красовались старательно окруженные «выкрутасами» слова: «Пиотр Кирсаноф, генерал-майор». В 1835 году Николай Петрович вышел из университета кандидатом, и в том же году генерал Кирсанов, уволенный в отставку за неудачный смотр, приехал в Петербург с женою на житье. Он нанял было дом у Таврического сада и записался в английский клуб, но внезапно умер от удара. Агафоклея Кузьминишна скоро за ним последовала: она не могла привыкнуть к глухой столичной жизни; тоска отставного существованья ее загрызла. Между тем Николай Петрович успел, еще при жизни родителей и к немалому их огорчению, влюбиться в дочку чиновника Преполовенского, бывшего хозяина его квартиры, миловидную и, как говорится, развитую девицу: она в журналах читала серьезные статьи в отделе «Наук». Он женился на ней, как только минул срок траура, и, покинув министерство уделов, куда по протекции отец его записал, блаженствовал со своею Машей сперва на даче около Лесного института, потом в городе, в маленькой и хорошенькой квартире, с чистою лестницей и холодноватою гостиной, наконец — в деревне, где он поселился окончательно и где у него в скором времени родился сын Аркадий. Супруги жили очень хорошо и тихо: они почти никогда не расставались, читали вместе, играли в четыре руки на фортепьяно, пели дуэты; она сажала цветы и наблюдала за птичьим двором, он изредка ездил на охоту и занимался хозяйством, а Аркадий рос да рос — тоже хорошо и тихо. Десять лет прошло как сон. В 47-м году жена Кирсанова скончалась. Он едва вынес этот удар, поседел в несколько недель; собрался было за границу, чтобы хотя немного рассеяться... но тут настал 48-й год. Он поневоле вернулся в деревню и после довольно продолжительного бездействия занялся хозяйственными преобразованиями. В 55-м году он повез сына в университет; прожил с ним три зимы в Петербурге, почти никуда не выходя и стараясь заводить знакомства с молодыми товарищами Аркадия. На последнюю зиму он приехать не мог, — и вот мы видим его в мае месяце 1859 года, уже совсем седого, пухленького и немного сгорбленного: он ждет сына, получившего, как некогда он сам, звание кандидата.
# Слуга, из чувства приличия, а может быть, и не желая остаться под барским глазом, зашел под ворота и закурил трубку. Николай Петрович 
# поник головой и начал глядеть на ветхие ступеньки крылечка: крупный пестрый цыпленок степенно расхаживал по ним, крепко стуча своими 
# большими желтыми ногами; запачканная кошка недружелюбно посматривала на него, жеманно прикорнув на перила. Солнце пекло; из полутемных 
# сеней постоялого дворика несло запахом теплого ржаного хлеба. Замечтался наш Николай Петрович. «Сын... кандидат... Аркаша...» — 
# беспрестанно вертелось у него в голове; он пытался думать о чем-нибудь другом, и опять возвращались те же мысли. Вспомнилась ему 
# покойница-жена... «Не дождалась!» — шепнул он уныло... Толстый сизый голубь прилетел на дорогу и поспешно отправился пить в лужицу 
# возле колодца. Николай Петрович стал глядеть на него, а ухо его уже ловило стук приближающихся колес..."""
    alphabet =     'абвгдежзийклмнопрстуфхцчшщъыьэюя'
    substitution = 'яюэыьъщшчцхфутсраонмлкйизжедгвбп'
    encrypted_text = ""
    s = s.lower()
    for char in s:
        if char in alphabet:
            encrypted_text += substitution[alphabet.index(char)]
        else:
            encrypted_text += char
    txt['text'] = encrypted_text
    print(encrypted_text)

def Rah():
    s=e.get()
    alphabet =     'яюэыьъщшчцхфутсраонмлкйизжедгвбп'
    substitution = 'абвгдежзийклмнопрстуфхцчшщъыьэюя'
    encrypted_text = ""
    for char in s:
        if char in alphabet:
            encrypted_text += substitution[alphabet.index(char)]
        else:
            encrypted_text += char
    txt['text'] = encrypted_text


# allowed_one_letter_words = ['а', 'и', 'о', 'у', 'с', 'к', 'я', 'в', 'б']

def Vzlom():
    # global allowed_one_letter_words
    # encrypted_text = e.get()
    encrypted_text = """ яюэыьъщшчцхфутсраонмлкйизжедгвбп
    эсэя ръх тсэдъ рдзхч тя жчръ. рязя ч тчхя э эяттъ
    инс, ръна, тъ эчьянг ъжъ? — ораязчэяф 20-ыс уяп 1859 ысья, эдксьп юъш зярхч тя тчшхсъ хадфъихс рсонспфсыс ьэсая тя *** зсооъ, юяачт фън 
    осасхя о тъюсфгзчу, э шярдфъттсу ряфгнс ч хфънияндк рятняфстяк, м оэсъыс офмыч, усфсьсыс ч жъхяонсыс уяфсыс о юъфсэянду рмксу тя 
    рсьюсасьхъ ч уяфътгхчуч нмохфдуч ыфяшътхяуч.
офмыя, э хснсасу эоъ: ч ючабшсэяп оъаъщхя э мкъ, ч тярсуящъттдъ аяштсйэънтдъ эсфсод, ч минчэдъ нъфсьэчщътчп, офсэсу, эоъ чшсюфчияфс 
иъфсэъхя тсэъцзъыс, мосэъазътонэсэяттсыс рсхсфътчп, рсоуснаъф отчоксьчнъфгтс эьсфг ьсасыч ч снэънонэсэяф: «тчхях тън-о, тъ эчьянг».
— тъ эчьянг? — рсэнсачф юяачт.
— тъ эчьянг, — энсачитс снэънонэсэяф офмыя.
юяачт эшьсктмф ч ачоъф тя охяуъъихм. рсштяхсучу о тчу ичнянъфп, рсхя ст очьчн, рсьсытмэзч рсь оъюп тсщхч ч шяьмуичэс рсыфпьдэяп хамысу.
шсэмн ъыс тчхсфяъу рънасэчиъу хчаоятсэду. м тъыс э рпнтяьйянч эъаоняк сн рсонспфсыс ьэсачхя ксасзъъ чуътчъ э ьэъонч ьмз, чфч, хях ст 
эдаящяъноп о нък рса, хях аяшуъщъэяфоп о хаъонгптяуч ч шяэъф «лъаум», — э ьэъ ндопич ьъопнчт шъуфч. снъй ъыс, юсъэсц ыътъаяф 1812 ысья,
рсфмыаяуснтдц, ыамюдц, тс тъ шфсц амоохчц иъфсэъх, эоб щчштг оэсб нптмф фпухм, хсуятьсэяф оръаэя юачыяьсц, рснсу ьчэчшчъц ч рсонспттс щчф
э расэчтйчч, ыьъ э очфм оэсъыс ичтя чыаяф ьсэсфгтс штяичнъфгтмб асфг. тчхсфяц ънасэчи асьчфоп тя быъ асоочч, рсьсютс оняазъум оэсъум юаянм
ряэфм, с хснсасу аъиг эръаъьч, ч эсорчндэяфоп ьс иъндатяьйянчфънтъыс эсшаяоня ьсуя, схамщъттдц ьъзъэдуч ымэъатъаяуч, аяшэпштдуч, тс   
рсьсюсонаяонтдуч яьебнятняуч ч асичуч сфхсэдуч ч зняютдуч фчитсонпуч. асьчнъфгтчйя ъыс, чш ляучфчч хсфпшчтдк, э ьъэчйяк agathe, я э 
ыътъаяфгзяк яыялсхфъп хмшгучтчзтя хчаоятсэя, рачтяьфъщяфя х ичофм «уянмзъх-хсуятьчаз», тсочфя рдзтдъ иърйд ч змутдъ зъфхсэдъ рфянгп, э

йъахэч рськсьчфя ръаэяп хс хаъонм, ысэсачфя ыасухс ч утсыс, ьсрмохяфя ьънъц мнасу х амихъ, тя тсиг чк юфяысофсэфпфя, — офсэсу, щчфя э 
оэсъ мьсэсфгонэчъ. э хяиъонэъ ыътъаяфгохсыс одтя тчхсфяц рънасэчи — кснп тъ нсфгхс тъ снфчияфоп каяюасонгб, тс ьящъ шяофмщчф расшэчжъ 
намочзхч — ьсфщът юдф, рсьсютс юаянм ряэфм, рсонмрчнг э эсъттмб офмщюм; тс ст ръаъфсучф оъюъ тсым э ояудц нсн ьътг, хсыья мщъ рачюдфс 
чшэъончъ сю ъыс сраъьъфътчч, ч, расфъщяэ ьэя уъопйя э рсонъфч, тя эоб щчштг соняфоп «касуътгхчу». снъй уяктмф тя тъыс амхсц ч рмончф  
ъыс рс знянохсц. ст рсэъш ъыс э рънъаюмаы, хях нсфгхс ъум учтмф эсоъутяьйяндц ысь, ч рсуъончф ъыс э мтчэъаочнън. хонянч, юаян ъыс с нм

рсам эдзъф слчйъасу э ыэяаьъцохчц рсфх. усфсьдъ фбьч оняфч щчнг эьэсъу, тя сьтсц хэяанчаъ, рсь сньяфъттду тяьшсасу ьэсбасьтсыс ьпьч о 
уянъачтохсц онсастд, чфгч хсфпшчтя, эящтсыс ичтсэтчхя. снъй чк эъатмфоп х оэсъц ьчэчшчч ч х оэсъц омрамыъ ч фчзг чшаъьхя рачодфяф     
одтсэгпу юсфгзчъ иънэъанмзхч оъасц юмуяыч, чоръжаъттдъ аяшуязчонду рчояаохчу рсиъахсу. тя хстйъ внчк иънэъанмзъх хаяосэяфчог оняаянъфгтс схамщъттдъ «эдхамняояуч» офсэя: «рчсна хчаоятсл, ыътъаяф-уяцса». э 1835 ысьм тчхсфяц рънасэчи эдзъф чш мтчэъаочнъня хятьчьянсу, ч э нсу щъ ысьм ыътъаяф хчаоятсэ, мэсфъттдц э сноняэхм шя тъмьяитдц оусна, рачъкяф э рънъаюмаы о щътсб тя щчнгъ. ст тятпф юдфс ьсу м няэачиъохсыс ояья ч шярчояфоп э ятыфчцохчц хфмю, тс этъшяртс муъа сн мьяая. яыялсхфъп хмшгучтчзтя охсас шя тчу рсофъьсэяфя: стя тъ усыфя рачэдхтмнг х ыфмксц онсфчитсц щчштч; нсохя сноняэтсыс омжъонэсэятгп ъъ шяыадшфя. уъщьм нъу тчхсфяц рънасэчи моръф, ъжъ рач щчштч асьчнъфъц ч х тъуяфсум чк сысаиътчб, эфбючнгоп э ьсихм ичтсэтчхя раърсфсэътохсыс, юдэзъыс ксшпчтя ъыс хэяанчад, учфсэчьтмб ч, хях ысэсачноп, аяшэчнмб ьъэчйм: стя э щматяфяк ичняфя оъагъштдъ онянгч э сньъфъ «тямх». ст щътчфоп тя тъц, хях нсфгхс учтмф оасх наямая, ч, рсхчтмэ учтчонъаонэс мьъфсэ, хмья рс раснъхйчч снъй ъыс шярчояф, юфящътонэсэяф ос оэсъб уязъц оръаэя тя ьяиъ схсфс фъотсыс чтончнмня, рснсу э ысасьъ, э уяфътгхсц ч ксасзътгхсц хэяанчаъ, о ичонсб фъонтчйъц ч ксфсьтсэянсб ысончтсц, тяхстъй — э ьъаъэтъ, ыьъ ст рсоъфчфоп схстиянъфгтс ч ыьъ м тъыс э охсасу эаъуътч асьчфоп одт яахяьчц. омрамыч щчфч сиътг ксасзс ч нчкс: стч рсинч тчхсыья тъ аяооняэяфчог, ичняфч эуъонъ, чыаяфч э иъндаъ амхч тя лсанъргптс, ръфч ьмвнд; стя оящяфя йэънд ч тяюфбьяфя шя рнчигчу ьэсасу, ст чшаъьхя ъшьчф тя скснм ч шятчуяфоп ксшпцонэсу, я яахяьчц асо ья асо — нсщъ ксасзс ч нчкс. ьъопнг фън расзфс хях ост. э 47-у ысьм щътя хчаоятсэя охстияфяог. ст ъьэя эдтъо внсн мьяа, рсоъьъф э тъохсфгхс тъьъфг; осюаяфоп юдфс шя ыаятчйм, инсюд кснп тъутсыс аяооъпнгоп... тс нмн тяоняф 48-ц ысь. ст рстъэсфъ эъатмфоп э ьъаъэтб ч рсофъ ьсэсфгтс расьсфщчнъфгтсыс юъшьъцонэчп шятпфоп ксшпцонэъттдуч раъсюаяшсэятчпуч. э 55-у ысьм ст рсэъш одтя э мтчэъаочнън; расщчф о тчу нач шчуд э рънъаюмаыъ, рсинч тчхмья тъ эдксьп ч оняаяпог шяэсьчнг штяхсуонэя о усфсьдуч нсэяачжяуч яахяьчп. тя рсофъьтбб шчум ст рачъкянг тъ усы, — ч эсн уд эчьчу ъыс э уяъ уъопйъ 1859 ысья, мщъ осэоъу оъьсыс, рмкфътгхсыс ч тъутсыс оысаюфъттсыс: ст щьън одтя, рсфмичэзъыс, хях тъхсыья ст ояу, шэятчъ хятьчьяня.
офмыя, чш имэонэя рачфчичп, я усщън юднг, ч тъ щъфяп сонянгоп рсь юяаохчу ыфяшсу, шязъф рсь эсасня ч шяхмачф намюхм. тчхсфяц рънасэчи 
рстчх ысфсэсц ч тяияф ыфпьънг тя эънкчъ онмрътгхч хадфъихя: хамртдц ръонадц йдрфътсх онъръттс аяокящчэяф рс тчу, хаърхс онмия оэсчуч  
юсфгзчуч щъфндуч тсыяуч; шяряихяттяп хсзхя тъьамщъфбютс рсоуяначэяфя тя тъыс, щъуяттс рачхсатмэ тя ръачфя. осфтйъ ръхфс; чш рсфмнъутдк

оътъц рсонспфсыс ьэсачхя тъофс шяряксу нърфсыс ащятсыс кфъюя. шяуъиняфоп тяз тчхсфяц рънасэчи. «одт... хятьчьян... яахязя...» —       
юъораъоняттс эъанъфсог м тъыс э ысфсэъ; ст рдняфоп ьмуянг с иъу-тчюмьг ьамысу, ч српнг эсшэаяжяфчог нъ щъ удофч. эорсутчфяог ъум      
рсхсцтчйя-щътя... «тъ ьсщьяфяог!» — зъртмф ст мтдфс... нсфонд очшдц ысфмюг рачфънъф тя ьсасым ч рсоръзтс снраяэчфоп рчнг э фмщчйм    
эсшфъ хсфсьйя. тчхсфяц рънасэчи оняф ыфпьънг тя тъыс, я мкс ъыс мщъ фсэчфс онмх рачюфчщябжчкоп хсфъо..."""
    # encrypted_text = "п чьм рс ояьм. эчщм: хсн орчн. ст няхсц рмзчондц! я эсн ч упи."
    frequencies = {
        'о': 0.090, 'е': 0.073, 'а': 0.062, 'и': 0.062, 'н': 0.053, 'т': 0.053, 'с': 0.045, 'р': 0.040, 'в': 0.038,
        'л': 0.035, 'к': 0.028, 'м': 0.026, 'д': 0.025, 'п': 0.023, 'у': 0.021, 'я': 0.018, 'ы': 0.016, 'з': 0.016,
        'ь': 0.014, 'б': 0.014, 'г': 0.013, 'ч': 0.012, 'й': 0.010, 'х': 0.009, 'ж': 0.007, 'ш': 0.006, 'ю': 0.006,
        'ц': 0.004, 'щ': 0.003, 'э': 0.003, 'ф': 0.002, 'ё': 0.000, 'ъ': 0.001
    }
    
    def count_frequencies(text):
        freq = {}
        total_chars = 0
        for char in text:
            if char.isalpha():
                if char in freq:
                    freq[char] += 1
                else:
                    freq[char] = 1
                total_chars += 1
        for char in freq:
            freq[char] /= total_chars
        return freq
    
    def match_frequencies(encrypted_freq, known_freq):
        sorted_encrypted = sorted(encrypted_freq.items(), key=lambda item: item[1], reverse=True)
        sorted_known = sorted(known_freq.items(), key=lambda item: item[1], reverse=True)
        mapping = {}
        for i in range(min(len(sorted_encrypted), len(sorted_known))):
            mapping[sorted_encrypted[i][0]] = sorted_known[i][0]
        return mapping
    
    # def match_frequencies(encrypted_freq, known_freq, allowed_one_letter_words):
    #     sorted_encrypted = sorted(encrypted_freq.items(), key=lambda item: item[1], reverse=True)
    #     sorted_known = sorted(known_freq.items(), key=lambda item: item[1], reverse=True)
    #     mapping = {}

    #     for i in range(min(len(sorted_encrypted), len(sorted_known))):
    #         encrypted_char, _ = sorted_encrypted[i]
    #         known_char, _ = sorted_known[i]

    #         # Check if the encrypted character is a potential one-letter word
    #         if encrypted_char.isalpha() and len(encrypted_char) == 1:
    #             if known_char in allowed_one_letter_words:
    #                 mapping[encrypted_char] = known_char
    #         else:
    #             mapping[encrypted_char] = known_char

    #     return mapping

    def decrypt_text(text, mapping):
        decrypted_text = ""
        for char in text:
            if char in mapping:
                decrypted_text += mapping[char]
            else:
                decrypted_text += char
        return decrypted_text
    
    encrypted_freq = count_frequencies(encrypted_text)
    mapping = match_frequencies(encrypted_freq, frequencies)
    # mapping = match_frequencies(encrypted_freq, frequencies, allowed_one_letter_words)
    decrypted_text = decrypt_text(encrypted_text, mapping)
    txt['text'] = decrypted_text
    print(decrypted_text)


Label( text = "Введите  сообщение: ").pack()
e = Entry( width=90, bd=50)
e.pack()
e.focus_set()

go = Button( text = "Зашифровать", command=Zah)
go.pack()

go1 = Button( text = "Расшифровать", command=Rah)
go1.pack()

go2 = Button( text = "Взлом", command=Vzlom)
go2.pack()

txt = Label(window, text="Результат", height=10, width=60)
txt.pack()

window.mainloop()


# def similarity(s1, s2):
#     from difflib import SequenceMatcher
#     return SequenceMatcher(None, s1, s2).ratio() * 100


# print(f"Процент совпадения: {similarity(string1, string2):.2f}%")